<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pr√©dicas | Iglesia Bautista Betesda</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    .fade-up {
      animation: fadeUp .5s ease both;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card-hover {
      transition: all .3s ease;
    }

    .card-hover:hover {
      transform: translateY(-6px);
      box-shadow: 0 15px 30px rgba(0,0,0,.15);
    }

    .floating-btn {
      position: fixed;
      right: 1rem;
      background: #000;
      color: #fff;
      padding: .7rem .8rem;
      border-radius: 999px;
      z-index: 50;
      box-shadow: 0 10px 20px rgba(0,0,0,.3);
      transition: all .3s ease;
    }

    .floating-btn:hover {
      background: #BF9B30;
      transform: scale(1.1);
    }

    #btn-top { bottom: 1.3rem; }
    #btn-back { bottom: 4.5rem; }
  </style>
</head>

<body class="bg-gray-100">

  <!-- HEADER -->
  <div id="header-placeholder"></div>

  <!-- MAIN -->
  <section class="min-h-screen">
    <div class="max-w-7xl mx-auto px-4 py-10">

      <!-- TITLE -->
      <div class="text-center mb-10 fade-up">
        <h1 class="text-4xl font-bold mb-4">Pr√©dicas y Ense√±anzas</h1>
        <p class="text-gray-600 max-w-3xl mx-auto">
          Predicaci√≥n b√≠blica para edificaci√≥n espiritual.  
          Todos los mensajes se actualizan autom√°ticamente desde nuestro canal de YouTube.
        </p>
      </div>

      <!-- SEARCH -->
      <div class="mb-8 fade-up">
        <input
          id="search"
          type="text"
          placeholder="Buscar pr√©dica por t√≠tulo..."
          class="w-full p-4 rounded-lg border focus:ring-2 focus:ring-[#BF9B30] outline-none"
        />
      </div>

      <!-- GRID -->
      <div
        id="video-grid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 fade-up">
      </div>

      <!-- NO RESULTS -->
      <div id="no-results" class="hidden text-center py-12">
        <p class="text-xl text-gray-600">No se encontraron pr√©dicas üìñ</p>
      </div>

      <!-- PAGINATION -->
      <div class="flex justify-center items-center gap-6 mt-12">
        <button id="prev"
          class="px-5 py-2 bg-black text-white rounded disabled:opacity-40">
          ‚óÄ Anterior
        </button>

        <span id="page-info" class="font-semibold"></span>

        <button id="next"
          class="px-5 py-2 bg-black text-white rounded disabled:opacity-40">
          Siguiente ‚ñ∂
        </button>
      </div>

    </div>
  </section>

  <!-- FOOTER -->
  <div id="footer-placeholder"></div>

  <!-- FLOATING BUTTONS -->
  <button id="btn-back" class="floating-btn" title="Volver">
    <i class="fas fa-arrow-left"></i>
  </button>

  <button id="btn-top" class="floating-btn" title="Ir arriba">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- GLOBAL JS -->
  <script src="js/loadComponents.js"></script>
  <script src="js/header-fix.js"></script>

  <!-- PAGE JS -->
  <script>
    const grid = document.getElementById("video-grid");
    const search = document.getElementById("search");
    const noResults = document.getElementById("no-results");

    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const pageInfo = document.getElementById("page-info");

    const PER_PAGE = 9;
    let videos = [];
    let filtered = [];
    let currentPage = 1;

    // üî§ Normalizar texto (ignorar tildes)
    const normalize = text =>
      text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

    // Cargar videos
    fetch("/api/predicas")
      .then(r => r.json())
      .then(data => {
        videos = data;
        filtered = videos;
        render();
      });

    // Buscar
    search.addEventListener("input", () => {
      const q = normalize(search.value);
      filtered = videos.filter(v =>
        normalize(v.title).includes(q)
      );
      currentPage = 1;
      render();
    });

    // Render
    function render() {
      grid.innerHTML = "";

      const totalPages = Math.ceil(filtered.length / PER_PAGE);
      noResults.classList.toggle("hidden", filtered.length > 0);

      const start = (currentPage - 1) * PER_PAGE;
      const pageItems = filtered.slice(start, start + PER_PAGE);

      pageItems.forEach(v => {
        const card = document.createElement("div");
        card.className = "bg-white rounded-xl shadow p-4 card-hover";

        card.innerHTML = `
          <img src="${v.thumbnail}" class="rounded-lg mb-4 w-full">
          <h3 class="font-semibold mb-3">${v.title}</h3>
          <iframe
            class="w-full aspect-video rounded-lg"
            src="https://www.youtube.com/embed/${v.id}"
            allowfullscreen>
          </iframe>
        `;

        grid.appendChild(card);
      });

      pageInfo.textContent = `P√°gina ${currentPage} de ${totalPages}`;
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage === totalPages || totalPages === 0;
    }

    prevBtn.onclick = () => {
      currentPage--;
      render();
    };

    nextBtn.onclick = () => {
      currentPage++;
      render();
    };

    document.getElementById("btn-top").onclick = () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    };

    document.getElementById("btn-back").onclick = () => {
      history.back();
    };
  </script>

</body>
</html>
