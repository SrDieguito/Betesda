<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Promesa de Fe – Reportes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .fade-up {
      animation: fadeUp .6s ease both;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen p-4">

  <div class="max-w-5xl mx-auto space-y-6 fade-up">

    <!-- HEADER -->
    <div class="bg-white rounded-xl shadow p-6 text-center">
      <h1 class="text-3xl font-bold text-gray-800">Promesa de Fe</h1>
      <p class="text-gray-600 mt-2">
        Reporte de ofrendas misioneras
      </p>
    </div>

    <!-- META -->
    <div class="bg-white rounded-xl shadow p-6">
      <label class="block text-sm font-semibold mb-2">
        Meta mensual ($)
      </label>
      <input id="meta"
        type="number"
        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-[#BF9B30]"
        placeholder="Ej: 2000">
    </div>

    <!-- INGRESO -->
    <div class="bg-white rounded-xl shadow p-6 grid md:grid-cols-3 gap-4">
      <input id="monto"
        type="number"
        placeholder="Monto ofrenda"
        class="p-3 border rounded-lg">

      <select id="dia"
        class="p-3 border rounded-lg">
        <option value="Jueves">Jueves</option>
        <option value="Domingo">Domingo</option>
      </select>

      <button onclick="agregar()"
        class="bg-[#BF9B30] text-white rounded-lg hover:bg-black transition">
        Agregar
      </button>
    </div>

    <!-- RESUMEN -->
    <div class="grid md:grid-cols-3 gap-4">
      <div class="bg-white rounded-xl shadow p-6 text-center">
        <div class="text-3xl font-bold text-[#BF9B30]" id="total">$0</div>
        <div class="text-gray-600">Total acumulado</div>
      </div>

      <div class="bg-white rounded-xl shadow p-6 text-center">
        <div class="text-3xl font-bold" id="porcentaje">0%</div>
        <div class="text-gray-600">Meta alcanzada</div>
      </div>

      <div class="bg-white rounded-xl shadow p-6">
        <div class="w-full bg-gray-200 rounded-full h-4">
          <div id="barra"
            class="bg-[#BF9B30] h-4 rounded-full transition-all"
            style="width:0%">
          </div>
        </div>
      </div>
    </div>

    <!-- GRÁFICO -->
    <div class="bg-white rounded-xl shadow p-6">
      <canvas id="grafico"></canvas>
    </div>

  </div>

<script>
let datos = JSON.parse(localStorage.getItem("promesa")) || [];
let metaInput = document.getElementById("meta");
let totalEl = document.getElementById("total");
let porcentajeEl = document.getElementById("porcentaje");
let barra = document.getElementById("barra");

metaInput.value = localStorage.getItem("meta") || "";

metaInput.oninput = () => {
  localStorage.setItem("meta", metaInput.value);
  render();
};

function agregar() {
  const monto = Number(document.getElementById("monto").value);
  const dia = document.getElementById("dia").value;
  if (!monto) return;

  datos.push({ monto, dia });
  localStorage.setItem("promesa", JSON.stringify(datos));
  document.getElementById("monto").value = "";
  render();
}

let chart;
function render() {
  const total = datos.reduce((a, b) => a + b.monto, 0);
  const meta = Number(metaInput.value) || 0;
  const porcentaje = meta ? Math.min((total / meta) * 100, 100) : 0;

  totalEl.textContent = `$${total.toFixed(2)}`;
  porcentajeEl.textContent = `${porcentaje.toFixed(1)}%`;
  barra.style.width = porcentaje + "%";

  const jueves = datos.filter(d => d.dia === "Jueves").reduce((a,b)=>a+b.monto,0);
  const domingo = datos.filter(d => d.dia === "Domingo").reduce((a,b)=>a+b.monto,0);

  if (chart) chart.destroy();

  chart = new Chart(document.getElementById("grafico"), {
    type: "bar",
    data: {
      labels: ["Jueves", "Domingo"],
      datasets: [{
        label: "Ofrendas ($)",
        data: [jueves, domingo],
        backgroundColor: ["#BF9B30", "#111827"]
      }]
    },
    options: {
      responsive: true,
      animation: { duration: 800 }
    }
  });
}

render();
</script>

</body>
</html>
