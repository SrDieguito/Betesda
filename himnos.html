<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Música Cristiana - IBFB</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ===== Animaciones ===== */
.card {
  animation: fadeUp .45s ease both;
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(18px); }
  to { opacity: 1; transform: translateY(0); }
}

.card:hover {
  transform: translateY(-4px) scale(1.01);
  transition: .3s ease;
}

#pagination button {
  transition: all .25s ease;
}

#pagination button:hover {
  transform: translateY(-2px);
}

/* ===== Mobile ajustes ===== */
@media (max-width: 768px) {
  header img {
    width: 56px;
    height: 56px;
  }

  h1 {
    font-size: 1.9rem !important;
  }

  audio {
    height: 42px;
  }

  .card {
    padding: 1rem;
  }
}

/* ===== Botones flotantes ===== */
.floating-btn {
  position: fixed;
  right: 1rem;
  z-index: 50;
  background: black;
  color: white;
  border-radius: 999px;
  padding: .7rem .8rem;
  box-shadow: 0 10px 20px rgba(0,0,0,.3);
}

#btn-top { bottom: 1.3rem; }
#btn-back { bottom: 4.8rem; }
</style>
</head>

<body class="bg-white">

<!-- HEADER -->
<header class="bg-black py-3 px-4 fixed w-full z-50">
<nav class="flex items-center justify-between max-w-7xl mx-auto">
<div class="flex items-center">
<img src="img/1.png" class="h-16 w-16 rounded-full">
<span class="text-[#BF9B30] ml-3 text-lg font-semibold">IBFB</span>
</div>
</nav>
</header>

<!-- MAIN -->
<section class="pt-28 pb-12 px-4 bg-gray-100 min-h-screen">
<div class="max-w-7xl mx-auto">

<h1 class="text-4xl font-bold text-center mb-8">Música Cristiana</h1>

<!-- FILTROS -->
<div class="mb-8 flex flex-col md:flex-row gap-4 justify-between items-center">
<input id="search-input"
type="text"
placeholder="Buscar por nombre..."
class="w-full md:w-1/2 p-3 border rounded focus:border-[#BF9B30]">

<select id="sort-select"
class="w-full md:w-1/4 p-3 border rounded focus:border-[#BF9B30]">
<option value="desc">Más reciente</option>
<option value="asc">Más antiguo</option>
</select>
</div>

<!-- GRID -->
<div id="resource-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

<!-- PAGINACIÓN -->
<div id="pagination" class="flex justify-center mt-10 gap-2 flex-wrap"></div>

</div>
</section>

<!-- FOOTER -->
<footer class="bg-black text-white py-6 text-center text-sm">
© 2025 Iglesia Bautista Fundamental Betesda
</footer>

<!-- BOTONES FLOTANTES (MÓVIL) -->
<button id="btn-back" class="floating-btn md:hidden">⬅️</button>
<button id="btn-top" class="floating-btn md:hidden">⬆️</button>

<!-- SCRIPT -->
<script>
const USUARIO = "SrDieguito";
const REPO = "ibfb-himnos";
const CARPETA = "musica";
const BASE = `https://raw.githubusercontent.com/${USUARIO}/${REPO}/main/${CARPETA}/`;

const grid = document.getElementById("resource-grid");
const searchInput = document.getElementById("search-input");
const sortSelect = document.getElementById("sort-select");
const pagination = document.getElementById("pagination");

const ITEMS_POR_PAGINA = 9;
let paginaActual = 1;
let songs = [];

/* ===== CARGAR MP3 ===== */
fetch(`https://api.github.com/repos/${USUARIO}/${REPO}/contents/${CARPETA}`)
.then(r => r.json())
.then(files => {
  songs = files
    .filter(f => f.name.endsWith(".mp3"))
    .map(file => ({
      name: file.name.replace(".mp3","").replace(/^\d+-?/,"").replace(/-/g," "),
      file: file.name,
      url: BASE + file.name
    }));
  render();
});

/* ===== RENDER ===== */
function render() {
  let filtered = songs.filter(s =>
    s.name.toLowerCase().includes(searchInput.value.toLowerCase())
  );

  filtered.sort((a,b) => {
    return sortSelect.value === "asc"
      ? a.file.localeCompare(b.file)
      : b.file.localeCompare(a.file);
  });

  const totalPaginas = Math.ceil(filtered.length / ITEMS_POR_PAGINA);
  paginaActual = Math.min(paginaActual, totalPaginas || 1);

  const inicio = (paginaActual - 1) * ITEMS_POR_PAGINA;
  const pagina = filtered.slice(inicio, inicio + ITEMS_POR_PAGINA);

  grid.innerHTML = "";

  pagina.forEach(song => {
    grid.innerHTML += `
    <div class="card bg-white rounded-lg shadow-lg p-6">
      <h3 class="text-lg font-semibold mb-3">${song.name}</h3>

      <audio controls preload="metadata" class="w-full mb-4">
        <source src="${song.url}" type="audio/mpeg">
      </audio>

      <a href="${song.url}" download
      class="inline-block bg-[#BF9B30] text-white px-4 py-2 rounded hover:bg-black">
      Descargar MP3
      </a>
    </div>`;
  });

  renderPagination(totalPaginas);
}

/* ===== PAGINACIÓN ===== */
function renderPagination(total) {
  pagination.innerHTML = "";
  for (let i = 1; i <= total; i++) {
    pagination.innerHTML += `
    <button onclick="goPage(${i})"
    class="px-4 py-2 rounded ${
      i===paginaActual ? 'bg-black text-white' : 'bg-gray-300'
    }">${i}</button>`;
  }
}

function goPage(n) {
  paginaActual = n;
  render();
  window.scrollTo({ top: 0, behavior: "smooth" });
}

/* ===== EVENTOS ===== */
searchInput.addEventListener("input", () => {
  paginaActual = 1;
  render();
});

sortSelect.addEventListener("change", () => {
  paginaActual = 1;
  render();
});

/* ===== BOTONES FLOTANTES ===== */
document.getElementById("btn-top").onclick = () =>
  window.scrollTo({ top: 0, behavior: "smooth" });

document.getElementById("btn-back").onclick = () =>
  history.back();
</script>

</body>
</html>
