<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Música Cristiana - IBFB</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ===== Animaciones ===== */
.card {
  animation: fadeUp .5s ease both;
}
@keyframes fadeUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.card:hover {
  transform: translateY(-4px) scale(1.01);
  transition: .3s ease;
}

#pagination button {
  transition: all .25s ease;
}

#pagination button:hover {
  transform: translateY(-2px);
}
</style>
</head>

<body class="bg-white">

<!-- HEADER -->
<header class="bg-black py-4 px-6 fixed w-full z-50">
<nav class="flex items-center justify-between max-w-7xl mx-auto">
<div class="flex items-center">
<img src="img/1.png" class="h-20 w-20 rounded-full">
<span class="text-[#BF9B30] ml-3 text-xl font-semibold">IBFB</span>
</div>
</nav>
</header>

<!-- MAIN -->
<section class="pt-32 pb-12 px-6 bg-gray-100 min-h-screen">
<div class="max-w-7xl mx-auto">

<h1 class="text-4xl font-bold text-center mb-8">Música Cristiana</h1>

<!-- FILTROS -->
<div class="mb-8 flex flex-col md:flex-row gap-4 justify-between items-center">
<input id="search-input"
type="text"
placeholder="Buscar por nombre..."
class="w-full md:w-1/2 p-3 border rounded focus:border-[#BF9B30]">

<select id="sort-select"
class="w-full md:w-1/4 p-3 border rounded focus:border-[#BF9B30]">
<option value="desc">Más reciente</option>
<option value="asc">Más antiguo</option>
</select>
</div>

<!-- GRID -->
<div id="resource-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>

<!-- PAGINACIÓN -->
<div id="pagination" class="flex justify-center mt-10 gap-2 flex-wrap"></div>

</div>
</section>

<!-- FOOTER -->
<footer class="bg-black text-white py-6 text-center">
© 2025 Iglesia Bautista Fundamental Betesda
</footer>

<!-- SCRIPT -->
<script>
const USUARIO = "SrDieguito";
const REPO = "ibfb-himnos";
const CARPETA = "musica";
const BASE = `https://raw.githubusercontent.com/${USUARIO}/${REPO}/main/${CARPETA}/`;

const grid = document.getElementById("resource-grid");
const searchInput = document.getElementById("search-input");
const sortSelect = document.getElementById("sort-select");
const pagination = document.getElementById("pagination");

const ITEMS_POR_PAGINA = 9;
let paginaActual = 1;
let songs = [];

/* ===== CARGAR MP3 ===== */
fetch(`https://api.github.com/repos/${USUARIO}/${REPO}/contents/${CARPETA}`)
.then(r => r.json())
.then(files => {
  songs = files
    .filter(f => f.name.endsWith(".mp3"))
    .map(file => ({
      name: file.name.replace(".mp3","").replace(/^\d+-?/,"").replace(/-/g," "),
      file: file.name,
      url: BASE + file.name
    }));
  render();
});

/* ===== RENDER GENERAL ===== */
function render() {
  let filtered = songs.filter(s =>
    s.name.toLowerCase().includes(searchInput.value.toLowerCase())
  );

  filtered.sort((a,b) => {
    return sortSelect.value === "asc"
      ? a.file.localeCompare(b.file)
      : b.file.localeCompare(a.file);
  });

  const totalPaginas = Math.ceil(filtered.length / ITEMS_POR_PAGINA);
  paginaActual = Math.min(paginaActual, totalPaginas || 1);

  const inicio = (paginaActual - 1) * ITEMS_POR_PAGINA;
  const pagina = filtered.slice(inicio, inicio + ITEMS_POR_PAGINA);

  grid.innerHTML = "";

  pagina.forEach(song => {
    grid.innerHTML += `
    <div class="card bg-white rounded-lg shadow-lg p-6">
      <h3 class="text-xl font-semibold mb-3">${song.name}</h3>

      <audio controls class="w-full mb-4">
        <source src="${song.url}" type="audio/mpeg">
      </audio>

      <a href="${song.url}" download
      class="inline-block bg-[#BF9B30] text-white px-4 py-2 rounded hover:bg-black">
      Descargar MP3
      </a>
    </div>
    `;
  });

  renderPagination(totalPaginas);
}

/* ===== PAGINACIÓN ===== */
function renderPagination(total) {
  pagination.innerHTML = "";

  for (let i = 1; i <= total; i++) {
    pagination.innerHTML += `
    <button onclick="goPage(${i})"
    class="px-4 py-2 rounded ${i===paginaActual ? 'bg-black text-white' : 'bg-gray-300'}">
    ${i}
    </button>
    `;
  }
}

function goPage(n) {
  paginaActual = n;
  render();
  window.scrollTo({top: 0, behavior: "smooth"});
}

/* ===== EVENTOS ===== */
searchInput.addEventListener("input", () => {
  paginaActual = 1;
  render();
});

sortSelect.addEventListener("change", () => {
  paginaActual = 1;
  render();
});
</script>

</body>
</html>
